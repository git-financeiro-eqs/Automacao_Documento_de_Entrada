
https://github.com/user-attachments/assets/3ce7503c-85be-4b42-ac98-60ba1ccaf73a


<br/>

- Primeira parte da execução do Bot após o usuário já ter sido inicializado no Chrome driver Selenium. Nesse trecho do processo de lançamento de uma NF, o Bot está clicando no botão _Ver Documentos_ para abrir o processo no portal. Ao abrir o processo no portal, ele coleta a URL do processo e abre a mesma página no Chrome driver Selenium. Através desse acesso virtual à pagina do processo, por meio da biblioteca Selenium, é possível mapear todos os elementos html presentes na página, o que nos permite extrair a chave de acesso da NF que está sendo lançada, e, com a chave de acesso, procurarmos o arquivo xml na pasta repositório de XMLs. Caso o arquivo XML ainda não esteja na pasta, o Microsiga permite que façamos a extração do XML diretamente na rotina Processo Pagamento, como ocorreu no vídeo, onde foi passado o caminho do diretório xmlFiscalio (pasta repositório) para receber o arquivo xml do processo. Então o Bot lê o arquivo e extrai os dados conforme está no módulo _extratorXML_. Depois clica em _Dados da Nota_ para iniciar o lançamento. Após inserir a TES 408 por padrão, a primeira conferência que ele faz é a da Filial de entrega, que precisa corresponder ao CNPJ do destinatário presente na NF. Caso não corresponda, o lançamento é cancelado e aquela chave de acesso é incorporada a uma lista de processos a serem ignorados pela automação. Quem deve efetuar a correção desses processos é um operador do setor financeiro.
<br/>
<br/>


https://github.com/user-attachments/assets/f332c8bb-f2ba-4ab7-a348-d9a708f4e57b

<br/>

- Segunda parte. Nesse momento o bot está aguardando que surja a tela de lançamento. Nessa tela ele começa a validação e inserção dos valores. Primeiro ele verifica se o valor total do item no processo corresponde ao valor total do item na NF. Essa ordenação de itens é pautada pelo xml. O primeiro item do xml, na grande maioria dos casos corresponde ao primeiro item do processo. Quando não corresponde, o bot cancela o lançamento e vai para o próximo, mas a grande maioria segue a mesma ordem. Quando o valor não bate, a primeira solução é tentar inserir o valor correto diretamente no campo (às vezes a diferença é de centavos), se acaso essa primeira solução não for aceita pelo sistema (o que não é o caso do vídeo), o bot verifica a quantidade do item no Microsiga e, se estiver de acordo com o xml, ele corrige o valor unitário no Siga para conforme está no xml. Caso a quantidade também não coincida, então ele tem duas alternativas que serão melhor explicadas no próximo trecho. Para o caso desse vídeo, os dois primeiros itens tiveram seus valores corrigidos diretamente no campo Valor Total. Após corrigido o valor, o bot verifica a natureza e parte para a inserção da TES. A TES é definida com base na natureza e nos impostos destacados para aquele item, além de um caso especifico definido pelo setor Fiscal, que são os casos dos itens que já vêm com a TES 406 por padrão. Essa TES precisa ser mantida, e o bot a mantém. Depois de inserida a TES, o bot insere os valores de _Desconto, Despesas Acessórias, Frete e Seguro_. Caso o item não tenha nenhum desses valores, o bot ainda assim insere o valor 0,00 nos campos afim de corrigir qualquer equivoco por parte do comprador no momento da criação do pedido. Depois, são inseridos os valores dos impostos, e então passa para o próximo item a ser verificado.
